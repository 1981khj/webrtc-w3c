<html xmlns="http://www.w3.org/1999/xhtml">
<head>
  <meta name="generator" content=
  "HTML Tidy for Linux/x86 (vers 11 February 2007), see www.w3.org" />
  <link href="getusermedia.css" rel="stylesheet" type="text/css" />
  <link href="ReSpec.js/css/respec.css" rel="stylesheet" type=
  "text/css" />

  <title>getusermedia: Getting access to local devices that can generate multimedia streams</title>
  <meta http-equiv='Content-Type' content='text/html; charset=utf-8' /><!-- 
      === NOTA BENE ===
      For the three scripts below, if your spec resides on dev.w3 you can check them
      out in the same tree and use relative links so that they'll work offline.

      To generate the dated version of the specification:

           Open this doc in Mozilla. 

           Do a CTRL-ALT-SHIFT-S

           Select "XHMTL( source)" from dialog box. This will pop a new tab with
           genreated version of the document.

           This will open a new tab with generated html. Copy and paste this to
           a new file. Note if you use Chrome or Safari, this step will not
           work. What will happen is the paste will have th original document,
           not what was displayed in the window that you did the copy on.

           Rename the new file to the correct day such as
           getusermedia-20111003.html then search for and edit the links for
           "This version" and "Previos version". Add the new file into git and
           check in. 

           Once everyone is happy, the getusermedia.html and
           getusermedia-20111003.html files can be coppied to
           getusermedia.html and getusermedia-20111003.html
           respectively in the ../editor/. W3C directory. 

     -->

  <script src='http://dev.w3.org/2009/dap/ReSpec.js/js/respec.js' class='remove' type=
  "text/javascript">
</script>

  <script class='remove' type="text/javascript">
//<![CDATA[
      var respecConfig = {
          previousURI: "-",
          // specification status (e.g. WD, LCWD, NOTE, etc.). If in doubt use ED.
          specStatus:           "ED",

         // the specification's short name, as in http://www.w3.org/TR/short-name/
          shortName:            "getusermedia",
          // if your specification has a subtitle that goes below the main
          // formal title, define it here
          // subtitle   :  "an excellent document",

          // if you wish the publication date to be other than today, set this
          // publishDate:  "2009-08-06",

          // new ability to override the copyright completely
                  overrideCopyright:  "<p class='copyright'>Initial Author of this Specification was Ian Hickson, Google Inc., with the following copyright statement:<br /> &#169; Copyright 2004-2011 Apple Computer, Inc., Mozilla Foundation, and Opera Software ASA. You are granted a license to use, reproduce and create derivative works of this document.</p> <p class='copyright'>All subsequent changes since 26 July 2011 done by the W3C WebRTC Working Group are under the following <a href='http://www.w3.org/Consortium/Legal/ipr-notice#Copyright'>Copyright</a>:<br />&#169; 2011 <a href='http://www.w3.org/'><acronym title='World Wide Web Consortium'>W3C</acronym></a><sup>&#174;</sup> (<a href='http://www.csail.mit.edu/'><acronym title='Massachusetts Institute of Technology'>MIT</acronym></a>, <a href='http://www.ercim.eu/'><acronym title='European Research Consortium for Informatics and Mathematics'>ERCIM</acronym></a>, <a href='http://www.keio.ac.jp/'>Keio</a>), All Rights Reserved. <a href='http://www.w3.org/Consortium/Legal/copyright-documents'>Document use</a>  rules apply.</p> <p class='copyright'>For the entire publication on the W3C site the <a href='http://www.w3.org/Consortium/Legal/ipr-notice#Legal_Disclaimer'>liability</a> and <a href='http://www.w3.org/Consortium/Legal/ipr-notice#W3C_Trademarks'>trademark</a> rules apply.</p>",


          // if the specification's copyright date is a range of years, specify
          // the start date here:
          // copyrightStart: "2005",

          // if there is a previously published draft, uncomment this and set its YYYY-MM-DD date
          // and its maturity status
          // previousPublishDate:  "1977-03-15",
          // previousMaturity:  "WD",

          // if there a publicly available Editor's Draft, this is the link
          edDraftURI:           "http://dev.w3.org/2011/webrtc/editor/getusermedia.html",

          // if this is a LCWD, uncomment and set the end of its review period
          // lcEnd: "2009-08-05",

          // if you want to have extra CSS, append them to this list
          // it is recommended that the respec.css stylesheet be kept
          extraCSS:             ["http://dev.w3.org/2009/dap/ReSpec.js/css/respec.css"],
  //          extraCSS:             ["../../../2009/dap/ReSpec.js/css/respec.css"],

          // editors, add as many as you like
          // only "name" is required
          editors:  [
  //              { name: "Your Name", url: "http://example.org/",
  //                company: "Your Company", companyURL: "http://example.com/" },
              { name: "Daniel C. Burnett", company: "Voxeo" },
              { name: "Anant Narayanan", company: "Mozilla" },
          ],

          // authors, add as many as you like. 
          // This is optional, uncomment if you have authors as well as editors.
          // only "name" is required. Same format as editors.

          //authors:  [
          //    { name: "Your Name", url: "http://example.org/",
          //      company: "Your Company", companyURL: "http://example.com/" },
          //],
          
          // name of the WG
          wg:           "Web Real-Time Communications Working Group",
          
          // URI of the public WG page
          wgURI:        "http://www.w3.org/2011/04/webrtc/",
          
          // name (with the @w3c.org) of the public mailing to which comments are due
          wgPublicList: "public-webrtc@w3.org",
          
          // URI of the patent status for this WG, for Rec-track documents
          // !!!! IMPORTANT !!!!
          // This is important for Rec-track documents, do not copy a patent URI from a random
          // document unless you know what you're doing. If in doubt ask your friendly neighbourhood
          // Team Contact.
          wgPatentURI:  "",
      };
  //]]>
  </script>
</head>

<body>
  <section id="abstract">

    <p>This document defines a set of APIs that allow local media,
    including audio and video, to be requested from a platform.
    </p>
  </section>

 <section id="sotd">
   <p>This document is not complete.
   It is subject to major changes and, while early experimentations are
   encouraged, it is therefore not intended for implementation. The API
   is based on preliminary work done in the WHATWG. The Web Real-Time
   Communications Working Group expects this specification to evolve
   significantly based on:</p>
  <ul>
    <li>Privacy issues that arise when exposing local capabilities and
    local streams.</li>
    <li>Technical discussions within the group.</li>
    <li>Experience gained through early experimentations.</li>
    <li>Feedback received from other groups and individuals.</li>
  </ul>
  
</section> 

  <section id="intro" class="informative">
  <h2>Introduction</h2>

  <p>Access to multimedia streams (video, audio, or both) from local devices (video
    cameras, microphones, Web cams) can have a number of uses, such as real-time 
    communication, recording, surveillance.</p>

  <p>This document defines the APIs used to get access to local devices (video
    cameras, microphones, Web cams) that can generate multimedia stream data. </p>
  </section>

  <section id="local-content">
  <h2>Obtaining local multimedia content</h2>

  <section id="local-content-definition">
  <h3>Definition</h3>

  <section>
  <h2>NavigatorUserMedia</h2>

  <dl title='[NoInterfaceObject] interface NavigatorUserMedia' class='idl'>
    <dt>void getUserMedia(MediaStreamOptions? options, NavigatorUserMediaSuccessCallback?
    successCallback, optional NavigatorUserMediaErrorCallback? errorCallback)</dt>

    <dd>
      <p>Prompts the user for permission to use their Web cam or other video or audio
      input.</p>

      <p>The optional <var title="">options</var> argument is an object of type
      <code><a href="#mediastreamoptions">MediaStreamOptions</a></code>. The object can contain
      the following boolean properties:
      </p>

      <dl>
        <dt>"<code title="">audio</code>"</dt>
        <dd>The provided media needs to include audio data.</dd>

        <dt>"<code title="">video</code>"</dt>
        <dd>The provided media needs to include video data.</dd>
      </dl>

      <p>If the user accepts, the <var title="">successCallback</var> is invoked, with a
      suitable <code><a href="http://www.w3.org/TR/2011/WD-webrtc-20111027/#localmediastream">LocalMediaStream</a></code> object [[!WEBRTC10]] as
      its argument.</p>

      <p>If the user declines, the <var title="">errorCallback</var> (if any) is
      invoked.</p>

      <p>When the <a href=
      "#widl-NavigatorUserMedia-getUserMedia-void-DOMString-options-NavigatorUserMediaSuccessCallback-successCallback-NavigatorUserMediaErrorCallback-errorCallback">
      <code>getUserMedia()</code></a> method is called, the user agent must run the
      following steps:</p>

      <ol>
        <li>
          <p>Let <var title="">options</var> be the method's first argument.</p>
        </li>

        <li>
          <p>Let <var title="">successCallback</var> be the callback indicated by the
          method's second argument.</p>
        </li>

        <li>
          <p>Let <var title="">errorCallback</var> be the callback indicated by the
          method's third argument, if any, or null otherwise.</p>
        </li>

        <li>
          <p>If <var title="">successCallback</var> is null, abort these steps.</p>
        </li><!-- we could throw an exception instead (that's
   why the method doesn't return until later: so that we can add an
   exception here, or for /options/ below, without changing the
   algorithm) -->

        <li>
          <p>Let <var title="">audio</var> be true.</p>
        </li>

        <li>
          <p>Let <var title="">video</var> be true.</p>
        </li>

        <li>
          <p>If the <var title="">audio</var> property in <var title="">options</var>
          is present and set to false, let <var title="">audio</var> be false.</p>
        </li>

        <li>
          <p>If the <var title="">video</var> property in <var title="">options</var>
          is present and set to false, let <var title="">video</var> be false.</p>
        </li>

        <li>
          <p>If both <var title="">audio</var> and <var title="">video</var> are still
          false, then throw a <code>NOT_SUPPORTED_ERR</code> exception and abort these
          steps.</p>
        </li>

        <li>
          <p>Return, and run the remaining steps asynchronously.</p>
        </li>

        <li>
          <p>Optionally, e.g. based on a previously-established user preference, for
          security reasons, or due to platform limitations, jump to the step labeled
          <em>failure</em> below.</p>
        </li>

        <li>
          <p>Prompt the user in a user-agent-specific manner for permission to provide
          the entry script's origin with a <code><a href=
          "http://www.w3.org/TR/2011/WD-webrtc-20111027/#localmediastream">LocalMediaStream</a></code> object [[!WEBRTC10]] representing a media
          stream.</p>

          <p>If <var title="">audio</var> is true, then the provided media should include
          an audio track. If <var title="">audio</var> is false, then the provided media
          must not include an audio track.</p>

          <p>If <var title="">video</var> is true, then the provided media should include
          a video track. If <var title="">video</var> is false, then the provided media
          must not include a video track.</p>

          <p>User agents are encouraged to default to using the user's primary or system
          default camera and/or microphone (as appropriate) to generate the media stream.
          User agents may allow users to use any media source, including pre-recorded
          media files.</p>

          <p>User agents may wish to offer the user more control over the provided media.
          For example, a user agent could offer to enable a camera light or flash, or to
          change settings such as the frame rate or shutter speed.</p>

          <p>If the user grants permission to use local recording devices, user agents
          are encouraged to include a prominent indicator that the devices are "hot"
          (i.e. an "on-air" or "recording" indicator).</p>

          <p>If the user denies permission, jump to the step labeled <em>failure</em>
          below. If the user never responds, this algorithm stalls on this step.</p>
        </li>

        <li>
          <p>Let <var title="">stream</var> be the <code><a href=
          "http://www.w3.org/TR/2011/WD-webrtc-20111027/#localmediastream">LocalMediaStream</a></code> object [[!WEBRTC10]] for which the user
          granted permission.</p>
        </li>

        <li>
          <p>Queue a task to invoke <var title="">successCallback</var> with
          <var title="">stream</var> as its argument.</p>
        </li>

        <li>
          <p>Abort these steps.</p>
        </li>

        <li>
          <p><em>Failure</em>: If <var title="">errorCallback</var> is null, abort these
          steps.</p>
        </li>

        <li>
          <p>Let <var title="">error</var> be a new <code><a href=
          "#navigatorusermediaerror">NavigatorUserMediaError</a></code> object whose
          <code title="dom-NavigatorUserMediaError-code"><a href=
          "#dom-navigatorusermediaerror-code">code</a></code> attribute has the numeric
          value 1 (<code title="dom-NavigatorUserMediaError-PERMISSION_DENIED"><a href=
          "#dom-navigatorusermediaerror-permission_denied">PERMISSION_DENIED</a></code>).</p>
        </li>

        <li>
          <p>Queue a task to invoke <var title="">errorCallback</var> with
          <var title="">error</var> as its argument.</p>
        </li>
      </ol>

      <p>The task source for these <span title="concept-task">tasks</span>
      is the user interaction task source.</p>
    </dd>
  </dl>

  <div title='Navigator implements NavigatorUserMedia' class='idl'></div>
  </section>

  <section>
  <h2>MediaStreamOptions</h2>

  <dl title='[NoInterfaceObject] interface MediaStreamOptions' class='idl'>
    <dt>attribute boolean audio</dt>
    <dd>Set to false if an audio track is not required, default is true</dd>

    <dt>attribute boolean video</dt>
    <dd>Set to false if a video track is not required, default is true</dd>
  </dl>
  </section>

  <section>
  <h2>NavigatorUserMediaSuccessCallback</h2>

  <dl title=
  '[Callback=FunctionOnly, NoInterfaceObject] interface NavigatorUserMediaSuccessCallback'
  class='idl'>
    <dt>void handleEvent(in LocalMediaStream stream)</dt>

    <dd>(Explanation of handleEvent TBD)</dd>
  </dl>
  </section>

  <section>
  <h2>NavigatorUserMediaError and NavigatorUserMediaErrorCallback</h2>

  <dl title='[NoInterfaceObject] interface NavigatorUserMediaError' class='idl'>
    <dt>const unsigned short PERMISSION_DENIED = 1</dt>

    <dd>The user denied the page permission to use the user's media devices.</dd>

    <dt>readonly attribute unsigned short code</dt>

    <dd>Returns the current error's error code. At this time, this will always be 1, for
    which the constant <code title=
    'dom-NavigatorUserMediaError-PERMISSION_DENIED'><a href=
    "#dom-navigatorusermediaerror-permission_denied">PERMISSION_DENIED</a></code> is
    defined.</dd>
  </dl>

  <dl title=
  '[Callback=FunctionOnly, NoInterfaceObject] interface NavigatorUserMediaErrorCallback'
  class='idl'>
    <dt>void handleEvent(in NavigatorUserMediaError error)</dt>

    <dd>(Explanation of handleEvent TBD)</dd>
  </dl>
  </section>
  </section>

  <section>
  <h3>Examples</h3>

  <div class="example">
    <p>A voice chat feature in a game could attempt to get access to the user's
    microphone by calling the API as follows:</p>
    <pre>
&lt;script&gt;
 navigator.getUserMedia({"audio": true, "video": false}, gotAudio);
 function gotAudio(stream) {
   // ... use 'stream' ...
 }
&lt;/script&gt;
</pre>
  </div>

  <div class="example">
    <p>A video-conferencing system would ask for both audio and video:</p>
    <pre>
&lt;script&gt;
   navigator.getUserMedia({"audio": true, "video": true}, gotStream);
 }
 function gotStream(stream) {
   // ... use 'stream' ...
 }
&lt;/script&gt;
</pre>
  </div>
  </section>
  </section>

  <section>
  <h2>Garbage collection</h2>


  </section>

  <section>
  <h2>Event definitions</h2>

-
  </section>

  <section class="informative">
  <h2>Event summary</h2>


  <section>
  <h2>Change Log</h2>
  <p> This section will be removed before publication. </p>

  <h3> To Do Items </h3>
  <p> - </p>

  <h3> Nov 29 2011</h3>
  <ol>
    <li> Changed examples to use MediaStreamOptions objects rather than strings. Minor edits.</li>
 </ol>


  <h3> Nov 15 2011</h3>
  <ol>
    <li> Removed MediaStream stuff. Refers to webrtc 1.0 spec for that part instead. </li>
 </ol>


  <h3> Nov 9 2011</h3>
  <ol>
    <li> Created first version by copying the webrtc spec and ripping out stuff. Put it on github. </li>
 </ol>
  
  </section>

 
  <section class="appendix">
  <h2>Acknowledgements</h2>


  </section>
</body>
</html>
